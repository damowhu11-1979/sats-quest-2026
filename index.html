<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SATs Quest 2026 – INFINITE + PDF SAVE</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body {font-family: Arial, sans-serif; background: #f0f0f0; margin:0; padding:20px 0;}
        .header {background: linear-gradient(#003087, #005eb8); color: white; padding: 20px; text-align: center; font-weight: bold; border-top: 8px solid #003087;}
        .ks2 {background: #005eb8; color:white; padding:12px 20px; font-size:2.2em; border-radius:10px; display:inline-block; margin:15px 0;}
        .page {background:white; margin:20px auto; max-width:950px; box-shadow:0 10px 30px rgba(0,0,0,0.2);}
        .question-container {padding:50px 60px; color:#000;}
        .qnum {float:left; width:90px; font-size:4em; font-weight:bold; color:#003087; margin:20px 0;}
        .question-text {font-size:2.2em; margin:40px 0 30px 100px; line-height:1.5;}
        .answer-area {text-align:center; margin:50px 0;}
        #answer-input {width:300px; height:70px; font-size:2.4em; text-align:center; border:3px solid #000; border-radius:6px;}
        #timer {font-size:2.8em; color:#d00; font-weight:bold; text-align:center; margin:20px 0;}
        button {background:#005eb8; color:white; padding:16px 32px; font-size:1.8em; border:none; border-radius:8px; cursor:pointer; margin:15px;}
        button:hover {background:#003087;}
        .end-early {background:#e74c3c !important;}
        .hidden {display:none !important;}
        #feedback {font-size:2.2em; margin:40px 0; min-height:70px; text-align:center;}
        .working-box {border: 5px solid #003087; background: #f8fbff; height: 380px; margin: 40px 0; padding:20px; border-radius:12px;}
        #working-input {width:100%; height:100%; border:none; background:transparent; resize:none; font-size:1.6em; outline:none;}
        .progress-container {width:100%; background:#ddd; height:50px; border-radius:25px; overflow:hidden; margin:30px 0; position:relative;}
        .progress-bar {height:100%; width:0%; background: linear-gradient(90deg, #ff006e, #8338ec, #3a86ff, #06ffa5, #ffba08); transition: width 0.7s ease;}
        .progress-text {position:absolute; width:100%; text-align:center; line-height:50px; color:white; font-weight:bold; font-size:1.8em; text-shadow: 2px 2px 6px #000;}
        .cover-page {padding:80px 60px; text-align:center;}
        .cover-page h1 {font-size:4.5em;}
        .name-table {width:80%; margin:50px auto; border-collapse:collapse; font-size:1.8em;}
        .name-table td {border:2px solid #000; padding:20px; height:60px;}
        .name-input {width:100%; border:none; font-size:1em; text-align:center;}
        .barcode {margin:80px 0; font-size:2.8em; letter-spacing:8px;}
    </style>
</head>
<body>

<!-- WELCOME -->
<div id="welcome" class="page">
    <div class="header"><div style="font-size:1.6em;">2026 national curriculum tests</div><div class="ks2">Key stage 2</div></div>
    <div class="question-container" style="text-align:center; padding-top:100px;">
        <h1 style="font-size:4em; color:#000;">Mathematics</h1>
        <br><br><br>
        <button onclick="startQuest('arithmetic')">Paper 1: Arithmetic<br><small>40 fresh questions • 30 min</small></button><br><br><br>
        <button onclick="startQuest('reasoning2')">Paper 2: Reasoning<br><small>35 brand-new questions</small></button><br><br><br>
        <button onclick="startQuest('reasoning3')">Paper 3: Reasoning<br><small>35 brand-new questions</small></button>
    </div>
</div>

<!-- OFFICIAL COVER – ONLY NAME -->
<div id="official-cover" class="page hidden">
    <div class="header"><div style="font-size:1.6em;">2026 national curriculum tests</div><div class="ks2">Key stage 2</div></div>
    <div class="cover-page">
        <h1>Mathematics</h1>
        <h2 id="paper-title" style="font-size:3em;"></h2>
        <table class="name-table">
            <tr><td>First name</td><td><input type="text" id="first-name" class="name-input" placeholder="Enter first name"></td></tr>
            <tr><td>Last name</td><td><input type="text" id="last-name" class="name-input" placeholder="Enter last name"></td></tr>
        </table>
        <div class="barcode" id="barcode">*K00070A0124*</div>
        <br><br>
        <button onclick="startGame()" style="font-size:2em; padding:20px 60px;">Start Test</button>
    </div>
</div>

<!-- GAME -->
<div id="game" class="page hidden">
    <div class="header"><div style="font-size:1.6em;">2026 national curriculum tests</div><div class="ks2">Key stage 2</div>
        <h2 id="level-title" style="margin:10px; font-size:2em; color:white;"></h2>
    </div>
    <div class="question-container">
        <div id="timer">30:00</div>
        <div class="progress-container">
            <div class="progress-bar" id="progress-bar"><div class="progress-text" id="progress-text">0 / 40</div></div>
        </div>
        <p style="text-align:center; font-size:1.8em;">Score: <strong id="score">0</strong> / <strong id="total">40</strong></p>
        <div class="qnum" id="q-number">1</div>
        <div class="question-text" id="question"></div>
        <div class="working-box">
            <strong>Show your working here</strong><br>
            <textarea id="working-input" placeholder="Type your working…"></textarea>
        </div>
        <div class="answer-area">
            <input type="text" id="answer-input" autocomplete="off" onkeypress="if(event.key==='Enter') checkAnswer()">
        </div>
        <div style="text-align:center;">
            <button onclick="checkAnswer()">Submit Answer</button>
            <button onclick="endEarly()" class="end-early">End Test Early</button>
        </div>
        <div id="feedback"></div>
    </div>
</div>

<!-- RESULTS + PDF SAVE -->
<div id="results" class="page hidden">
    <div class="header"><div style="font-size:1.6em;">2026 national curriculum tests</div><div class="ks2">Key stage 2</div></div>
    <div class="question-container" style="text-align:center; padding-top:80px;">
        <h1 style="font-size:4.5em;">Test Complete!</h1>
        <h1 style="font-size:6em; color:#005eb8;"><span id="final-score">0</span> / <span id="final-total">40</span></h1>
        <p id="result-message" style="font-size:3em; margin:50px;"></p>
        <button onclick="saveAsPDF()" style="font-size:2em; padding:20px 60px; background:#27ae60;">Save Results + Working as PDF</button><br><br>
        <button onclick="restart()" style="font-size:2em; padding:20px 60px;">Back to Menu</button>
    </div>
</div>

<script>
    const { jsPDF } = window.jspdf;
    const correctSound = new Audio('https://assets.mixkit.co/sfx/preview/mixkit-arcade-game-jump-coin-216.mp3');
    const wrongSound = new Audio('https://assets.mixkit.co/sfx/preview/mixkit-wrong-answer-fail-notification-946.mp3');

    let paper = [], q = 0, score = 0, timer, timeLeft;
    let studentName = "";
    let workings = [];

    // Same generateArithmetic() and generateReasoning() as before (omitted for space – keep your previous ones)

    function startQuest(type) {
        document.getElementById('welcome').classList.add('hidden');
        document.getElementById('official-cover').classList.remove('hidden');
        // set title & barcode as before
    }

    function startGame() {
        studentName = (document.getElementById('first-name').value + " " + document.getElementById('last-name').value).trim() || "Student";
        document.getElementById('official-cover').classList.add('hidden');
        document.getElementById('game').classList.remove('hidden');
        workings = [];
        // rest of start logic
    }

    function checkAnswer() {
        // ... same as before
        workings.push({q: q+1, question: paper[q].text, working: document.getElementById('working-input').value, correct: user===correct});
        // then q++, updateProgress(), etc.
    }

    function saveAsPDF() {
        const doc = new jsPDF();
        let y = 20;
        doc.setFontSize(16);
        doc.text("KS2 SATs Mathematics Results", 105, y, {align: "center"});
        y += 10;
        doc.setFontSize(14);
        doc.text(`Name: ${studentName}`, 20, y); y += 10;
        doc.text(`Paper: ${document.getElementById('level-title').textContent}`, 20, y); y += 10;
        doc.text(`Score: ${score} / ${paper.length}`, 20, y); y += 15;

        doc.setFontSize(12);
        workings.forEach(w => {
            if(y > 270) { doc.addPage(); y = 20; }
            doc.text(`Q${w.q}: ${w.question.substring(0,80)}${w.question.length>80?"...":""}`, 20, y); y += 7;
            if(w.working) doc.text(`Working: ${w.working.substring(0,100)}`, 25, y); y += 7;
            doc.text(w.correct ? "✓ Correct" : "✗ Wrong", 25, y); y += 10;
        });

        doc.save(`${studentName}_SATs_Results.pdf`);
    }

    function endQuest() {
        clearInterval(timer);
        document.getElementById('game').classList.add('hidden');
        document.getElementById('results').classList.remove('hidden');
        document.getElementById('final-score').textContent = score;
        const msg = score < 10 ? "Good effort! You can do this – keep trying!" :
                    score <= 25 ? "Keep going – you’re doing really well!" :
                    score <= 39 ? "Amazing work! Nearly at Greater Depth!" :
                    "110+ LEGEND! GREATER DEPTH ACHIEVED!";
        document.getElementById('result-message').textContent = msg;
    }

    // Keep all your previous generateArithmetic, generateReasoning, numberToWords, etc.
</script>
</body>
</html>
